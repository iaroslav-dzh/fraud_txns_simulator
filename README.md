
# Симулятор фрод транзакций

## Указатель

- [О чем этот проект](#о-чем-этот-проект)
- [Установка зависимостей проекта](#установка-зависимостей-проекта)
	- [Клонирование репозитория](#клонирование-репозитория)
	- [Установка poetry](#установка-poetry)
		- [Windows (Powershell)](#windows-powershell)
		- [Linux, macOS, Windows (WSL)](#linux-macos-windows-wsl)
	- [Создание виртуальной среды](#создание-виртуальной-среды)
	- [Активация виртуальной среды](#активация-виртуальной-среды)
		- [Windows (powershell)](#windows-powershell-1)
		- [Линукс](#линукс)
- [Возможные ошибки при настройке окружения](#возможные-ошибки-при-настройке-окружения)
	- [Ошибка  `returned non-zero exit status 9009`](#ошибка--returned-non-zero-exit-status-9009)
	- [`UnauthorizedAccess Error` в powershell](#unauthorizedaccess-error-в-powershell)
- [Другие инструкции](#другие-инструкции)
	- [Подключение poetry env как kernel в Jupyter](#подключение-poetry-env-как-kernel-в-jupyter)
- [Запуск генератора](#запуск-генератора)


## О чем этот проект

Реализовал на python генерацию синтетических банковских транзакций: легальных и мошеннических с учётом поведения клиентов и реализма сценариев. 
Моделирование транзакций. Полученные датасеты можно использовать для тестирования работы правил антифрод системы.

**Стек:** python (pandas, numpy, geopandas, matplotlib, ООП), Poetry, Power BI (модель данных, DAX)  

----------------------

1. Очистил и преобразовал данные под генерацию при помощи pandas, numpy, geopandas.
2. Написал модульный генератор транзакций при помощи функций и ООП. Разные разделы логики генератора это разные файлы, функции и классы, но точка запуская - единая. Вот схема:
**[ссылка](https://miro.com/app/board/uXjVJXMulTI=/?focusWidget=3458764636425951315)**
3. Конфигурации генератора транзакций поместил в YAML файлы, чтобы их можно было менять без исправления кода.
4. Процесс документировал в jupyter ноутбуках - там обработка начальных данных и демонстрация главных функций и классов генератора. Также есть сайт с описанием проекта, где на каждый раздел есть страница с описанием.
5. Загрузил данные в Power BI, создал модель данных и на ее основании дашборд с информацией о транзакциях. Создал визуализации, применил условное форматирование, создал DAX меры.
6. Зависимости проекта прописал в toml файле.

**Итоги проекта:**

-------------------

- Полученные датасеты можно использовать для тестирования работы правил антифрод системы.
- Улучшил навыки обработки данных в pandas, numpy, geopandas.
- Приобрел опыт написания систематизированного и связного кода. Компоненты отдельные, могут тестироваться по отдельности, но связаны в систему. Считаю что такой опыт очень полезен для работы с ETL, обработкой данных.
- Научился работать с конфигурациями в файлах (YAML).
- Приобрел опыт ведения и выполнения объемной задачи от начала до конца: 14 jupyter ноутбуков с документированием процесса, более 2-х месяцев работы, примерно 4000 строк кода в модуле генератора.

Более развернутое описание проекта **[по ссылке](https://iaroslav-dzh.github.io/fraud_txns_simulator/index.html)** - это сайт проекта. Там более подробное описание генератора транзакций по разделам.

**Мошенничества (фрода) два типа:** 

--------------------

1. *compromised client fraud* - банковский аккаунт или карта клиента скомпрометированы.
2. дроп фрод - клиент является дропом, дропов два типа: которые просто посредники в переправке потока денег (*распределители*) и которые занимаются отмыванием через покупку товаров на присланные им деньги (*покупатели*)    

Фрод генерируется в соответствии с антифрод правилами. Т.е. транзакции генерируются с такими характеристиками, чтобы попадать под конкретные антифрод правила. В случае с *compromised client fraud* правило выбирается случайно и под него генерируется транзакция/и.  
<br><br>

## Установка зависимостей проекта

-------------

**Все зависимости**, включая модули проекта прописаны в `pyproject.toml` файле.
Предлагаю установить их при помощи менеджера зависимостей **[poetry](https://python-poetry.org/docs/)**.  

### Клонирование репозитория

```bash
git clone https://github.com/iaroslav-dzh/fraud_txns_simulator.git
```

### Установка poetry
---------------

#### Windows (Powershell)
```powershell
(Invoke-WebRequest -Uri https://install.python-poetry.org -UseBasicParsing).Content | py -
```  

При установке для **Windows** через powershell добавить путь ниже в `path` **для пользователя**
```
C:\Users\<ИМЯ_ПОЛЬЗОВАТЕЛЯ>\AppData\Roaming\Python\Scripts
```
- [Как добавить путь в переменную среды PATH в Windows](https://remontka.pro/add-to-path-variable-windows/)  

После установки и добавления пути в `path` перезапустить терминал, затем проверить:
```
poetry --version
```  
<br>

#### Linux, macOS, Windows (WSL)
```bash
curl -sSL https://install.python-poetry.org | python3 -
```

При установке для **Линукс** или **macOS** добавить путь ниже в `PATH`
```bash
$HOME/.local/bin
```
- [Как добавить путь в PATH на **Линукс**](https://iaroslav-dzh.github.io/fraud_txns_simulator/installation/how_to_add_poetry_to_path_linux.html)  

После установки и добавления пути в `PATH` перезапустить терминал, затем проверить:
```
poetry --version
```    
<br><br>

### Создание виртуальной среды

- Создание среды, установка всех зависимостей, включая собственные модули согласно  файлу `pyproject.toml`
<br>

Перейти в директорию проекта(клонированного репозитория) и исполнить команду
```
poetry install
```    

Будет создана виртуальная среда и установлены все зависимости    
<br><br>

### Активация виртуальной среды

Чтобы войти в виртуальную среду где установлены все зависимости.  
Документация Poetry: [Activating the environment](https://python-poetry.org/docs/managing-environments/#activating-the-environment)  
<br>

#### Windows (powershell)

Находясь в директории проекта в терминале исполнить команду
```powershell
Invoke-Expression (poetry env activate)
```  

**ЛИБО**<br>

Исполнить
```
poetry env activate
```  

И затем скопировать вывод команды. Если это путь к скрипту, например:
```
"C:\Users\<ИМЯ_ПОЛЬЗОВАТЕЛЯ>\AppData\Local\pypoetry\Cache\virtualenvs\<НАЗВАНИЕ_СРЕДЫ>\Scripts\activate.ps1"
```  

Вставить вывод в терминал и нажать Enter
```
C:\Users\<ИМЯ_ПОЛЬЗОВАТЕЛЯ>\AppData\Local\pypoetry\Cache\virtualenvs\<НАЗВАНИЕ_СРЕДЫ>\Scripts\activate.ps1
```  
<br>

#### Линукс

Находясь в директории проекта в терминале исполнить команду
```bash
eval $(poetry env activate)
```  

**ЛИБО**<br>

Исполнить
```
poetry env activate
```  

И затем скопировать вывод команды. Это может быть команда и путь, например:
```bash
source home/<ИМЯ_ПОЛЬЗОВАТЕЛЯ>/.cache/pypoetry/virtualenvs/<ИМЯ_СРЕДЫ>/activate
```  

Вставить вывод в терминал и нажать Enter
<br><br>

## Возможные ошибки при настройке окружения

---------------------------------

### Ошибка  `returned non-zero exit status 9009`

Poetry не может найти python.  

Если в консоли будет что-то типа:
```
Command '['C:\\Users\\<USER>\\AppData\\Local\\Microsoft\\WindowsApps\\python.EXE', '-EsSc', 'import sys; print(sys.executable)']' returned non-zero exit status 9009.
```  

Это исправляется командой:
```
poetry config virtualenvs.use-poetry-python true
```  

Теперь poetry использует python который использовался при ее установке.    
<br>

### `UnauthorizedAccess Error` в powershell 

Исполнить команду ниже. Для разрешения исполнения скриптов в текущей сессии powershell
```
Set-ExecutionPolicy RemoteSigned -Scope Process
```  

Справка:
- https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.security/set-executionpolicy?view=powershell-7.5  
<br><br>

## Другие инструкции
----------------------------------

### Подключение poetry env как kernel в Jupyter

1. Зайти в виртуальную среду
2. Установить ipykernel `poetry add ipykernel`
3. Зарегистрировать poetry среду как ядро в Jupyter

```
python -m ipykernel install --user --name=poetry-env --display-name "Python (poetry-env)"
```

4. Запустить Jupyter Notebook (можно из Anaconda или терминала), и в списке ядер (kernels) выберите `Python (poetry-env)`.   
<br><br>

## Запуск генератора

Чтобы запустить генератор транзакций:
1. Войти в виртуальную среду проекта
2. Исполнить команду  

```
python run_generator.py
```  

У генератора транзакций могут быть заданы конфигурации через `yaml` файлы в папке `config/`. Подробнее об этом в [Основные конфигурации и запуск генератора](https://iaroslav-dzh.github.io/fraud_txns_simulator/07_generator_configs_and_start.html)



