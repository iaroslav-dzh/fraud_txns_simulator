<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title></title>

<style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.6;
      color: #111827; /* darker text for better contrast */
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #ffffff;
    }
    pre {
      background-color: #f3f4f6; /* gray-100 */
      border-radius: 6px;
      padding: 16px;
      overflow: auto;
      border: 1px solid #e5e7eb; /* gray-200 */
    }
    code {
      font-family: SFMono-Regular, Consolas, 'Liberation Mono', Menlo, monospace;
      background-color: #f3f4f6; /* gray-100 */
      color: #111827; /* gray-900 */
      border-radius: 4px;
      padding: 0.2em 0.4em;
      font-weight: 500;
    }
    table {
      border-collapse: collapse;
      width: auto;
      margin-top: 40px 0;
      margin-bottom: 40px;
    }
    table, th, td {
      border: 1px solid #d1d5db; /* gray-300 */
    }
    th {
      padding: 8px 8px;
      text-align: center;
      background-color: #f9fafb; /* gray-50 */
      font-weight: 600;
      color: #111827; /* gray-900 */
    }
    td {
      padding: 2px 2px;
      text-align: center;
      color: #1f2937; /* gray-800 */
    }
    blockquote {
      border-left: 4px solid #9ca3af; /* gray-400 */
      padding: 12px 16px;
      margin-left: 0;
      margin-right: 0;
      background-color: #f9fafb; /* gray-50 */
      color: #374151; /* gray-700 */
      font-style: italic;
      border-radius: 0 4px 4px 0;
    }
    img {
      max-width: 100%;
      border-radius: 4px;
      margin: 16px 0;
    }
    h1, h2, h3, h4, h5, h6 {
      color: #111827; /* gray-900 */
      font-weight: 700;
      margin-top: 24px;
      margin-bottom: 16px;
      line-height: 1.25;
    }
    h2, h3, h4, h5, h6 {
      margin-top: 40px;
    }
    h1 {
      font-size: 2em;
      border-bottom: 1px solid #e5e7eb; /* gray-200 */
      padding-bottom: 0.3em;
    }
    h2 {
      font-size: 1.5em;
      border-bottom: 1px solid #e5e7eb; /* gray-200 */
      padding-bottom: 0.3em;
    }
    h3 {
      font-size: 1.25em;
    }
    p {
      margin-top: 30px;
      margin-bottom: 16px;
    }
    a {
      color: #2563eb; /* blue-600 */
      text-decoration: none;
    }
    details {
      margin-top: 40px;
      margin-bottom: 40px;
    }
    a:hover {
      text-decoration: underline;
    }
    ul, ol {
      padding-left: 2em;
      margin-top: 0;
      margin-bottom: 16px;
    }
    li {
      margin-bottom: 4px;
    }
    li > ul, li > ol {
      margin-top: 4px;
      margin-bottom: 0;
    }
  </style>
  <style>
.pagination {
  display: inline-block;
  padding-top: 40px;
}

.pagination a {
  color: black;
  background-color: #66cfc8;
  float: left;
  padding: 8px 16px;
  text-decoration: none;
  transition: background-color .3s;
  border: 1px solid #ddd;
}

.pagination a.active {
  background-color: #4CAF50;
  color: white;
  border: 1px solid #4CAF50;
}

.pagination a:hover:not(.active) {background-color: #ddd;}
</style>                  
        </head>
        <body>
<div class="pagination">
  <a href="index.html">Главная</a>
  <a href="03_Генерация_легальных_транзакций.html">❮ Назад - Легальные транзакции</a>
  <a href="05_Дропы.html">Дропы - Далее ❯</a>
</div>
<h1 id="генерация-compromised-fraud-транзакций">Генерация compromised
fraud транзакций</h1>
<p><strong>Репозиторий проекта:</strong>
  <a href="https://github.com/iaroslav-dzh/fraud_txns_simulator" target="_blank"><strong>Ссылка</strong></a><br />
<strong>Диаграммы:</strong> Подробная <a
href="https://miro.com/app/board/uXjVJXMulTI=/?focusWidget=3458764636425951315" target="_blank"><strong>диаграмма</strong></a> структуры генератора 
</p>
<p><strong>Ноутбук</strong>:</p>
<ul><li>
  <a href="notebooks/09_Генерация_compromised_clients_фрода.html" target="_blank">
  Генерация compromised clients фрода</a>
</li></ul>
<h2>Указатель</h2>
<ol>
  <li><a href="#суть-генерации">Суть генерации</a></li>
  <li><a href="#конфиги-и-данные-для-генерации">Конфиги и данные для генерации</a></li>
  <li><a href="#генерация-времени">Генерация времени</a></li>
  <li><a href="#генерация-части-данных-транзакции">Генерация части данных транзакции</a></li>
  <li><a href="#генерация-суммы-транзакции">Генерация суммы транзакции</a></li>
  <li><a href="#генерация-одной-транзакции">Генерация одной транзакции</a></li>
  <li><a href="#генерация-нескольких-транзакций">Генерация нескольких транзакций</a></li>
  <li><a href="#оркестрация-генерации">Оркестрация генерации</a></li>
</ol>

<h2 id="суть-генерации">Суть генерации</h2>
<p>Генерируется фрод под несколько антифрод правил. Это значит, что
транзакции генерируются с такими значениями, чтобы попадать под
придуманные антифрод правила. Транзакции при генерации сразу помечаются
под какое они правило. В итоговой таблице это просто выглядит как-будто
был детект по конкретному антифрод правилу.</p>
<p>Правило выбирается случайно, но у правил есть веса, но их можно
изменить т.к. правила берутся из класса с конфигами, а класс с конфигами
берет их из файла.</p>
<p><strong>Список правил</strong></p>
<ol type="1">
<li><code>fast_geo_change</code> - быстрая смена геопозиции между
транзакциями, при том фрод транзакция - оффлайн. Метрика это просто
скорость с которой нужно перемещаться между совершением транзакций,
чтобы вписаться по времени в расстояние между ними. В конфиг файле под
этот фрод - <code>compr.yaml</code> - выставляется пороговая скорость
км/ч, например 800, выше этого порога - фрод по этому правилу.</li>
<li><code>fast_geo_change_online</code> - то же самое что и первое, но
для онлайн транзакций т.е. когда текущая транзакция это онлайн</li>
<li><code>new_device_and_ip</code> - транзакция с незнакомого устройства
и IP-адреса. IP-адрес при этом отличного от клиента города. Отличается
от правил с гео скачком, тем что при создании времени учитывается
расстояние между координатами транзакций и порог скорости - скорость
всегда ниже или равна пороговой, чтобы не попадать под гео правило.</li>
<li><code>new_device_and_high_amount</code> - транзакция с незнакомого
устройства и IP-адреса. <strong>Но при этом</strong> IP-адрес совпадает
по городу с городом клиента. Также транзакция на большую сумму - у
compromised фрода свои параметры для сумм по категориям покупок.</li>
<li><code>trans_freq_increase</code> - внезапное учащение транзакций.
Серия из более чем <em>n</em> транзакций с интервалами например до 5
минут. <em>n</em> это порог с которого частые транзакции “детектятся” по
этому правилу, например, 4 транзакции. <em>n</em> выставляется в конфигах
- <code>compr.yaml</code>. Там же выставляется мин. и макс. возможные
интервалы между транзакциями при таком фроде, по умолчанию это 1 и 5
минут.</li>
</ol>
<p><strong>Все правила кроме</strong> <code>trans_freq_increase</code>
подразумевают генерацию одной транзакции на клиента. Для
<code>trans_freq_increase</code> в конфиг файле выставляется мин. и
макс. возможное число транзакций в серии для одного клиента. Мин.
значение является также порогом с которого происходит “детект” по этому
правилу.</p>
<p>Сгенерированные транзакции пишутся в отдельный файл.</p>
<h2 id="конфиги-и-данные-для-генерации">Конфиги и данные для
генерации</h2>
<p>Также как и в легальных транзакциях у compromised фрода есть свои
конфиги и данные в которых он нуждается для генерации. Все это точно
также упаковывается в конфиг класс и передается в функции и классы
относящиеся к compromised фроду.</p>
<ul>
<li><code>ComprClientFraudCfg</code> - конфиг класс</li>
<li><code>ComprConfigBuilder</code> - конструктор конфиг класса - конфиг
билдер</li>
</ul>
<h2 id="генерация-времени">Генерация времени</h2>
<p>Время всегда основывается на времени последней легальной транзакции.
Т.к. координаты создаваемой транзакции генерируются до создания её
времени, то при создании времени считается дистанция между координатами
последней легальной транзакции и текущей. И в соответствии с правилом и
выставленным порогом скорости перемещения высчитывается разница во
времени между последней легальной и фрод транзакцией - в случае с
<code>trans_freq_increase</code> между последней легальной и первой фрод
в серии транзакций, последующие фрод транзакции уже отталкиваются от
времени предыдущей фрод транзакции и прибавляют случайную небольшую
разницу в соот-вии с конфигами.</p>
<p><strong>Функции</strong></p>
<ul>
<li><code>generate_time_fast_geo_jump</code> - генерация времени для
фрода с резкой сменой геолокации</li>
<li><code>gen_time_for_frequent_trans</code> - генерация времени для
фрода с резким учащением транзакций</li>
<li><code>derive_from_last_time</code> - создать время основываясь на
времени предыдущей транзакции. Обеспечивает генерацию времени не
попадающего под фрод с резкой сменой гео. Или также может просто
прибавлять фиксированный и случайный интервал для генерации
времени.</li>
<li><code>get_time_fraud_txn</code> - конечная функция генерации времени
для compromised фрода, использует все функции выше</li>
</ul>
<h2 id="генерация-части-данных-транзакции">Генерация части данных
транзакции</h2>
<p>Также как и для легальных транзакций, часть данных транзакции
генерируется отдельным объектом. В случае с compromised фродом это: ID
мерчанта, координаты, город, id устройства, канал транзакции, тип
транзакции. Этим занимается отдельный класс -
<code>FraudTxnPartData</code>. Этот класс генерирует эти данные в
соответствии с выпавшим антифрод правилом.</p>
<p><strong>Разница с легальными транзакциями в том что</strong>:</p>
<ul>
<li>под правила где есть смена гео нужно выбрать другой город. Только в
одном правиле город может совпадать с городом клиента -
<code>new_device_and_high_amount</code></li>
<li>для онлайн транзакций выбрать другой IP и id устройства, которые не
совпадают с клиентскими</li>
</ul>
<h2 id="генерация-суммы-транзакции">Генерация суммы транзакции</h2>
<p>Для compromised фрода сумму генерирует отдельный класс -
<code>TransAmount</code>. В него передается объект конфиг класса в
котором есть информация о категориях покупок и характеристиках их сумм
чисто под фрод. Также в конфиг классе содержатся отдельные
характеристики сумм под правило <code>trans_freq_increase</code></p>
<h2 id="генерация-одной-транзакции">Генерация одной транзакции</h2>
<p><strong>Функция</strong> <code>gen_purchase_fraud_txn</code>. В
основном использует отдельные функции и классы для генерации данных</p>
<ol type="1">
<li>случайно выбирает категорию исходя из переданного правила - через
специальную функцию</li>
<li>генерирует сумму - через <code>TransAmount</code></li>
<li>генерирует частичные данные - через
<code>FraudTxnPartData</code></li>
<li>считает гео дистанцию от последней легальной транзакции - через
функцию <code>calc_distance</code></li>
<li>генерирует время - через функцию
<code>get_time_fraud_txn</code></li>
<li>остаточные данные, например: статус, флаг <code>is_fraud</code>,
метку правила определят сама.</li>
</ol>
<h2 id="генерация-нескольких-транзакций">Генерация нескольких
транзакций</h2>
<p><strong>Функция</strong> <code>gen_multi_fraud_txns</code></p>
<ol type="1">
<li>Проходит циклом через переданных в конфиг классе клиентов</li>
<li>На каждом клиенте случайно выбирает правило, под которое создастся
транзакция</li>
<li>Если правило это <code>trans_freq_increase</code> то выбирает
случайное число транзакций и генерирует это кол-во при помощи
специальной функции обертки для функции создания одной транзакции -
<code>trans_freq_wrapper</code></li>
<li>Если это другое правило, то просто генерирует одну транзакцию через
функцию создания одной транзакции
<code>gen_purchase_fraud_txn</code></li>
<li>Когда все сгенерировано, то транзакции записываются в файл в двух
копиях при помощи специального класса
<code>FraudTxnsRecorder</code></li>
</ol>
<h2 id="оркестрация-генерации">Оркестрация генерации</h2>
<p><strong>Для compromised фрода</strong> есть отдельный класс
оркестратор - <code>ComprRunner</code>, который получает на вход данные
конфиг файлов и путь к директории текущего запуска. Исходя из этих
данных он создает объект конфиг билдера, через билдер создает объект
конфиг класса и объекты других нужных классов.<br />
При вызове <code>run()</code> метода оркестратора происходит полный
процесс генерации compromised fraud транзакций.</p>
<div class="pagination">
  <a href="index.html">Главная</a>
  <a href="03_Генерация_легальных_транзакций.html">❮ Назад - Легальные транзакции</a>
  <a href="05_Дропы.html">Дропы - Далее ❯</a>
</div>  
        </body>
        </html>